<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>M365 Admin Companion</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; }
    #status-bar { background: #f0f0f0; padding: 10px; font-size: 12px; border-bottom: 1px solid #ccc; display: flex; justify-content: space-between; align-items: center; }
    .status-indicator { display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: grey; margin-right: 5px; }
    .status-green { background: #107C10; } /* Microsoft Green */
    .status-red { background: #E81123; }
    .status-yellow { background: #FFB900; }
    
    #chat-container { flex: 1; padding: 15px; overflow-y: auto; background: #faf9f8; }
    .message { margin-bottom: 10px; padding: 10px; border-radius: 8px; max-width: 85%; font-size: 13px; line-height: 1.4; }
    .msg-agent { background: white; border: 1px solid #e1dfdd; align-self: flex-start; }
    .msg-user { background: #d0e7f9; align-self: flex-end; margin-left: auto; color: #000; }
    .msg-system { background: #fff4ce; border: 1px solid #dac27d; align-self: center; font-size: 11px; width: 90%; text-align: left; }
    
    #input-area { padding: 15px; border-top: 1px solid #ccc; background: white; display: flex; gap: 10px; }
    input { flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px; outline: none; }
    input:focus { border-color: #0078D4; }
    button { padding: 8px 15px; background: #0078D4; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:disabled { background: #ccc; }
    
    #login-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; text-align: center; padding: 20px; }
    .hidden { display: none !important; }

    /* Loading Indicator */
    .typing-indicator { 
        display: inline-block; 
        background-color: #f1f0f0; 
        padding: 5px 10px; 
        border-radius: 15px; 
        margin-bottom: 10px;
        align-self: flex-start;
    }
    .typing-indicator span {
        display: inline-block;
        width: 6px;
        height: 6px;
        background-color: #888;
        border-radius: 50%;
        animation: typing 1s infinite ease-in-out;
        margin: 0 2px;
    }
    .typing-indicator span:nth-child(1) { animation-delay: 0s; }
    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes typing {
        0% { transform: translateY(0); opacity: 0.6; }
        50% { transform: translateY(-4px); opacity: 1; }
        100% { transform: translateY(0); opacity: 0.6; }
    }

    /* Privacy Shield Styles */
    .pii-highlight { background-color: #ffe6e6; border-bottom: 2px dashed red; cursor: help; }
    .payload-preview { font-family: monospace; font-size: 11px; background: #333; color: #0f0; padding: 10px; border-radius: 5px; margin-top: 5px; white-space: pre-wrap; display: none; }
  </style>
</head>
<body>

  <div id="login-overlay">
    <h2 style="color: #0078D4;">M365 Companion</h2>
    <p>Secure, Cloud-First Assistant</p>
    <div style="margin: 20px 0;">
        <p style="font-size: 12px; color: #666; margin-bottom: 5px;">Backend Connection</p>
        <div id="backend-status-indicator" class="status-indicator status-red"></div>
    </div>
    <button id="btn-login" disabled>Connect to Agent</button>
    <p id="login-status" style="margin-top:10px; font-size:11px; color: #666; max-width: 200px;">Waiting for Backend...</p>
  </div>

  <div id="status-bar">
    <div>
        <span id="connection-dot" class="status-indicator status-red"></span> 
        <span id="connection-text" style="font-weight: 600;">Disconnected</span>
    </div>
    <div id="user-display" style="font-size: 10px; color: #666;">Guest</div>
  </div>

  <div id="chat-container">
    <div class="message msg-agent">
      <strong>ðŸ‘‹ Welcome!</strong>
      <br><br>
      I am your secure, local assistant. I can help you create Graph Connectors without your data ever leaving your control unnecessarily.
    </div>
  </div>

  <script src="sidepanel.js"></script>
</body>
</html>
